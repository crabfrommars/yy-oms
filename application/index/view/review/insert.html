<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>创建评审单</title>
    <link rel="stylesheet" href="/static/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/static/layuiadmin/style/admin.css" media="all">
    <script src="/static/layuiadmin/layui/layui.js"></script>
</head>
<body>

<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-header layuiadmin-card-header-auto">
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">订单号</label>
                    <div class="layui-input-inline">
                        <input id="target_order" type="text" class="layui-input" placeholder="输入要关联的订单编号">
                    </div>
                </div>
                <div class="layui-inline">
                    <button id="confirm_target" class="layui-btn layui-btn-normal">确定</button>
                </div>
            </div>
        </div>
        <div class="layui-card-body">
            <form class="layui-form" lay-filter="insert" id="insert" style="padding: 20px 30px 0 0;">
                <div class="layui-form-item">
                    <label class="layui-form-label"><span class="my-must">*</span>关联订单号</label>
                    <div class="layui-input-inline">
                        <input type="text" class="layui-input" lay-verify="required" name="order_id" readonly>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label"><span class="my-must">*</span>客户名</label>
                        <div class="layui-input-inline">
                            <input type="text" class="layui-input" lay-verify="required" name="customer">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label"><span class="my-must">*</span>项目名</label>
                        <div class="layui-input-inline">
                            <input type="text" class="layui-input" lay-verify="required" name="project_name">
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label"><span class="my-must">*</span>申请人</label>
                        <div class="layui-input-inline">
                            <input type="text" class="layui-input" lay-verify="required" name="applicant">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label"><span class="my-must">*</span>申请部门</label>
                        <div class="layui-input-inline">
                            <input type="text" class="layui-input" lay-verify="required" name="app_department">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">申请日期</label>
                        <div class="layui-input-inline">
                            <input id="app_date" type="text" class="layui-input" lay-verify="required" name="app_date">
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label"><span class="my-must">*</span>量产时间</label>
                        <div class="layui-input-inline">
                            <input type="text" class="layui-input" lay-verify="required" name="pro_time">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label"><span class="my-must">*</span>量产规模</label>
                        <div class="layui-input-inline">
                            <input type="text" class="layui-input" lay-verify="required" name="pro_scale">
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label"><span class="my-must">*</span>型号(描述)</label>
                        <div class="layui-input-inline">
                            <input type="text" class="layui-input" lay-verify="required" name="description">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label"><span class="my-must">*</span>目标售价</label>
                        <div class="layui-input-inline">
                            <input type="text" class="layui-input" lay-verify="required" name="price" placeholder="¥">
                        </div>
                    </div>
                </div>
                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label"><span class="my-must">*</span>项目背景</label>
                    <div class="layui-input-block">
                        <textarea name="project_bg" class="layui-textarea" lay-verify="required"></textarea>
                    </div>
                </div>
                技术要求
                <hr>
                <div class="layui-form-item">
                    <label class="layui-form-label"><span class="my-must">*</span>应用场景</label>
                    <div class="layui-input-block">
                        <input type="text" class="layui-input" lay-verify="required" name="situation">
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label"><span class="my-must">*</span>额定电压</label>
                        <div class="layui-input-inline">
                            <input type="text" class="layui-input" lay-verify="required" name="vol">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label"><span class="my-must">*</span>额定电流</label>
                        <div class="layui-input-inline">
                            <input type="text" class="layui-input" lay-verify="required" name="amp">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label"><span class="my-must">*</span>额定功率</label>
                        <div class="layui-input-inline">
                            <input type="text" class="layui-input" lay-verify="required" name="power">
                        </div>
                    </div>
                </div>
                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label"><span class="my-must">*</span>技术要求</label>
                    <div class="layui-input-block">
                        <textarea name="tech_req" class="layui-textarea" lay-verify="required"></textarea>
                    </div>
                </div>
                客户附加要求
                <hr>
                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">客户要求</label>
                    <div class="layui-input-block">
                        <textarea name="customer_req" class="layui-textarea"></textarea>
                    </div>
                </div>
                <div class="layui-form-item layui-layout-admin">
                    <div class="layui-input-block">
                        <div class="layui-footer" style="left: 0;">
                            <button type="button" class="layui-btn" lay-submit lay-filter="submit">提交</button>
                            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script type="text/javascript">
    layui.use(['form','laydate','table'],function () {
        let form=layui.form
            , laydate=layui.laydate
            , table=layui.table
            , $=layui.$;

        $("#target_order").focus();

        $("#confirm_target").click(function () {
            $.ajax({
                url:'/index/order/getOrders'
                , data:{
                    'id':$("#target_order").val()
                }
                , type:'POST'
                , success:(res)=>{
                    if (res.code === 0){
                        form.val('insert',{
                            "order_id":res.order.id
                            , "customer":res.order.customer
                            , "applicant":res.order.salesman
                            , "description":res.order.model
                            , "vol":res.order.vol1
                            , "amp":res.order.amp1
                            , "power":res.order.power
                        });
                    } else {
                        layer.msg(res.msg,{
                            icon:5
                            , time:2000
                        });
                    }
                }
            })
        });

        $("#target_order").keydown(function (event) {
            if (event.keyCode == 13) {
                $("#confirm_target").click();
            }
        });

        laydate.render({
            elem:'#app_date'
            , value:new Date()
        });
        
        $('#associate').click(function () {
            // layer.open({
            //     type:2
            //     , title:'选择要关联的订单'
            //     , offset:['30px','150px']
            //     , area:['500px','500px']
            //     , content:'/index/review/renderAssociate'
            //     , btn:['提交','取消']
            //     , btnAlign:'c'
            //     , closeBtn:2
            //     , yes:function (index,layero) {
            //
            //         var body = layer.getChildFrame('body', index);
            //         var iframeWin=window[layero.find('iframe')[0]['name']];
            //         let data=null;
            //         iframeWin.layui.table.on('radio(orders)',function (obj) {
            //             console.log(obj.data);
            //         });
            //         layer.close(index);
            //     }
            // });
        });

        form.on('submit(submit)',function (data) {
            layer.confirm(
                '确定吗'
                , {icon:0,title:'确定'}
                , function (index) {
                    layer.close(index);
                    let field=data.field;
                    // console.log(field);
                    $.ajax({
                        url:'/index/review/ins'
                        , data:field
                        , type:'POST'
                        , success:(res)=>{
                            if (res.code === 0){
                                layer.msg(res.msg,{icon:1});
                            } else if (res.code === 1){
                                layer.msg(res.msg,{icon:2});
                            }
                        }
                    })
                }
            );
        });
    })
</script>
<style>
    .my-must{
        color:red;
    }
</style>
</body>
</html>